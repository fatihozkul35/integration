<!-- İletişim Formu Bileşeni -->
{% if not hide_title %}
<h2 class="h3 mb-4">{% if form_title %}{{ form_title }}{% else %}Bize Mesaj Gönderin{% endif %}</h2>
{% endif %}

{% if messages %}
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endfor %}
{% endif %}

<form method="post" action="{% if form_action %}{% url form_action %}{% else %}{% url 'integration_app:contact' %}{% endif %}" id="{% if form_id %}{{ form_id }}{% else %}contact-form{% endif %}" novalidate>
    {% csrf_token %}
    
    <h4 class="h5 mb-3 mt-4">Kişisel Bilgiler</h4>
    <div class="mb-3">
        <label for="name" class="form-label">
            Ad Soyad
        </label>
        <input type="text" class="form-control" id="name" name="name">
    </div>
    
    <div class="row">
        <div class="col-md-6 mb-3">
            <label for="age" class="form-label">
                Yaş <span class="text-danger">*</span>
            </label>
            <input type="number" class="form-control" id="age" name="age" min="18" max="100" required>
        </div>
        <div class="col-md-6 mb-3">
            <label for="marital_status" class="form-label">
                Medeni Durum <span class="text-danger">*</span>
            </label>
            <select class="form-select" id="marital_status" name="marital_status" required>
                <option value="">Seçiniz</option>
                <option value="bekar">Bekar</option>
                <option value="evli">Evli</option>
            </select>
        </div>
    </div>
    
    <div class="row">
        <div class="col-md-6 mb-3">
            <label for="children_count" class="form-label">
                Çocuk Sayısı <span class="text-danger">*</span>
            </label>
            <input type="number" class="form-control" id="children_count" name="children_count" min="0" max="10" value="0" required>
        </div>
        <div class="col-md-6 mb-3">
            <label for="driving_license" class="form-label">
                Sürücü Belgesi Sınıfı <span class="text-danger">*</span>
            </label>
            <input type="text" class="form-control" id="driving_license" name="driving_license" placeholder="Örn: B, C, D" required>
        </div>
    </div>
    
    <h4 class="h5 mb-3 mt-4">Mesleki Bilgiler</h4>
    <div class="row">
        <div class="col-md-6 mb-3">
            <label for="profession" class="form-label">
                Meslek <span class="text-danger">*</span>
            </label>
            <input type="text" class="form-control" id="profession" name="profession" placeholder="Örn: Mühendis, Doktor, Öğretmen" required>
        </div>
        <div class="col-md-6 mb-3">
            <label for="graduation" class="form-label">
                Mezuniyet <span class="text-danger">*</span>
            </label>
            <input type="text" class="form-control" id="graduation" name="graduation" placeholder="Örn: Üniversite, Meslek Lisesi" required>
        </div>
    </div>
    
    <h4 class="h5 mb-3 mt-4">İletişim Bilgileri</h4>
    <div class="row">
        <div class="col-md-6 mb-3">
            <label for="email" class="form-label">
                E-Posta <span class="text-danger">*</span>
            </label>
            <input type="email" class="form-control" id="email" name="email" required>
        </div>
        <div class="col-md-6 mb-3">
            <label for="phone" class="form-label">
                İrtibat Numarası
            </label>
            <input type="tel" class="form-control" id="phone" name="phone" placeholder="+90 5XX XXX XX XX">
        </div>
    </div>
    <div class="mb-3">
        <p class="text-muted small">
            <span class="text-danger">*</span> E-Posta zorunludur. İrtibat numarası isteğe bağlıdır.
        </p>
    </div>
    
    <h4 class="h5 mb-3 mt-4">Mesaj</h4>
    <div class="mb-3">
        <label for="message" class="form-label">
            Mesajınız
        </label>
        <textarea class="form-control" id="message" name="message" rows="6" placeholder="Sorularınızı veya talebinizi buraya yazabilirsiniz..."></textarea>
    </div>
    
    <div class="mb-3">
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="consent" name="consent" required>
            <label class="form-check-label" for="consent">
                Bu verilerin iletişim kurma amacıyla saklanması ve işlenmesine onay veriyorum. Onayımı istediğim zaman geri çekebileceğimi biliyorum. <span class="text-danger">*</span>
            </label>
        </div>
    </div>
    
    <div class="mb-3">
        <p class="text-muted small">
            <span class="text-danger">*</span> İşaretli alanlar zorunludur. Lütfen tüm zorunlu alanları doldurun ve gizlilik politikasına onay verin.
        </p>
    </div>
    
    <div class="d-grid">
        <button type="submit" class="btn btn-primary btn-lg">
            Gönder
        </button>
    </div>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const contactForm = document.getElementById('{% if form_id %}{{ form_id }}{% else %}contact-form{% endif %}');
    if (!contactForm) return;
    
    // Tüm required alanları bul
    const requiredFields = contactForm.querySelectorAll('[required]');
    
    // Input değiştiğinde hata durumunu temizle
    requiredFields.forEach(function(field) {
        field.addEventListener('input', function() {
            if (this.value.trim() !== '') {
                this.classList.remove('is-invalid');
                this.style.borderColor = '';
            }
        });
        
        // Select için change event
        if (field.tagName === 'SELECT') {
            field.addEventListener('change', function() {
                if (this.value !== '') {
                    this.classList.remove('is-invalid');
                    this.style.borderColor = '';
                }
            });
        }
        
        // Checkbox için change event
        if (field.type === 'checkbox') {
            field.addEventListener('change', function() {
                if (this.checked) {
                    this.classList.remove('is-invalid');
                    this.style.borderColor = '';
                    this.style.borderWidth = '';
                }
            });
        }
    });
    
    contactForm.addEventListener('submit', function(e) {
        let isValid = true;
        let firstInvalidField = null;
        
        // Tüm required alanları kontrol et
        requiredFields.forEach(function(field) {
            let isEmpty = false;
            
            // Checkbox için özel kontrol
            if (field.type === 'checkbox') {
                isEmpty = !field.checked;
            }
            // Select için özel kontrol
            else if (field.tagName === 'SELECT') {
                isEmpty = field.value.trim() === '';
            } else {
                isEmpty = field.value.trim() === '';
            }
            
            if (isEmpty) {
                isValid = false;
                // Kırmızı border ekle
                field.classList.add('is-invalid');
                field.style.borderColor = '#dc3545';
                field.style.borderWidth = '2px';
                
                // İlk boş alanı kaydet
                if (!firstInvalidField) {
                    firstInvalidField = field;
                }
            } else {
                // Geçerli ise border'ı temizle
                field.classList.remove('is-invalid');
                field.style.borderColor = '';
                field.style.borderWidth = '';
            }
        });
        
        // Eğer geçersiz alanlar varsa
        if (!isValid) {
            e.preventDefault();
            
            // İlk boş alana focus yap
            if (firstInvalidField) {
                firstInvalidField.focus();
                firstInvalidField.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            
            return false;
        }
    });
});
</script>

<style>
    .is-invalid {
        border-color: #dc3545 !important;
        border-width: 2px !important;
    }
    
    .is-invalid:focus {
        border-color: #dc3545 !important;
        box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25) !important;
    }
    
    .form-check-input.is-invalid {
        border-color: #dc3545 !important;
        border-width: 2px !important;
    }
    
    .form-check-input.is-invalid:focus {
        border-color: #dc3545 !important;
        box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25) !important;
    }
</style>

